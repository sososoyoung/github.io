<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>react 服务端渲染后客户端重新渲染原因分析 | 豆腐di青春</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="1. 问题描述：当我们使用react进行服务端渲染的时候常会遇到在客户端又重新渲染（非期望的重复渲染）的问题，react提示如下： 123React attempted to reuse markup in a container but the checksum was invalid. This generally means that you are using server renderi">
<meta property="og:type" content="article">
<meta property="og:title" content="react 服务端渲染后客户端重新渲染原因分析">
<meta property="og:url" content="https://sososoyoung.github.io/2017/08/25/react-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E5%90%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%87%8D%E6%96%B0%E6%B8%B2%E6%9F%93%E5%8E%9F%E5%9B%A0%E5%88%86%E6%9E%90/index.html">
<meta property="og:site_name" content="豆腐di青春">
<meta property="og:description" content="1. 问题描述：当我们使用react进行服务端渲染的时候常会遇到在客户端又重新渲染（非期望的重复渲染）的问题，react提示如下： 123React attempted to reuse markup in a container but the checksum was invalid. This generally means that you are using server renderi">
<meta property="og:locale">
<meta property="article:published_time" content="2017-08-25T11:40:28.000Z">
<meta property="article:modified_time" content="2022-02-08T05:27:17.361Z">
<meta property="article:author" content="豆腐di青春">
<meta property="article:tag" content="react-server-render">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="豆腐di青春" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">豆腐di青春</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Front End Engineer</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://sososoyoung.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-react-服务端渲染后客户端重新渲染原因分析" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/08/25/react-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E5%90%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%87%8D%E6%96%B0%E6%B8%B2%E6%9F%93%E5%8E%9F%E5%9B%A0%E5%88%86%E6%9E%90/" class="article-date">
  <time class="dt-published" datetime="2017-08-25T11:40:28.000Z" itemprop="datePublished">2017-08-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/react/">react</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      react 服务端渲染后客户端重新渲染原因分析
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="1-问题描述："><a href="#1-问题描述：" class="headerlink" title="1. 问题描述："></a>1. 问题描述：</h3><p>当我们使用react进行服务端渲染的时候常会遇到在客户端又重新渲染（非期望的重复渲染）的问题，react提示如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">React attempted to reuse markup in a container but the checksum was invalid. This generally means that you are using server rendering and the markup generated on the server was not what the client was expecting. React injected new markup to compensate which works but you have lost many of the benefits of server rendering. Instead, figure out why the markup being generated is different on the client or server:</span><br><span class="line"> (client) &lt;!-- react-empty: 1 -</span><br><span class="line"> (server) &lt;div class=&quot;castboxGl</span><br></pre></td></tr></table></figure>
<h3 id="2-产生该问题的原因："><a href="#2-产生该问题的原因：" class="headerlink" title="2.产生该问题的原因："></a>2.产生该问题的原因：</h3><ol>
<li><p>两端渲染的数据源不一致：通常我们会将服务端渲染时的使用的数据同样传递到客户端，两端共用同一组数据渲染确保一致性。常见代码如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server side:</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(initialData)</span><br><span class="line"><span class="keyword">const</span> content = <span class="title function_">renderToString</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">RouterContext</span> &#123;<span class="attr">...renderProps</span>&#125;/&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line">...</span><br><span class="line">&lt;div id=<span class="string">&quot;root&quot;</span>&gt;$&#123;content&#125;&lt;/div&gt;</span><br><span class="line">&lt;!-- 下面将state传递到客户端 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="variable language_">window</span>.<span class="property">__INITIAL_STATE__</span> = $&#123;<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(state)&#125;;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// client side:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(<span class="variable language_">window</span>.<span class="property">__INITIAL_STATE__</span>)</span><br><span class="line">...</span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Router</span> <span class="attr">history</span>=<span class="string">&#123;getHistory(store)&#125;</span> <span class="attr">onUpdate</span>=<span class="string">&#123;logPageView&#125;</span> <span class="attr">routes</span>=<span class="string">&#123;rootRoute&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span>, rootElement</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
</li>
<li><p>maybe it’s just because there is an additional wrapper <div> with devTools enabled?<br><a target="_blank" rel="noopener" href="https://github.com/Hashnode/mern-starter/issues/139">https://github.com/Hashnode/mern-starter/issues/139</a></p>
</li>
<li><p>after implementing react-router code splitting<br><a target="_blank" rel="noopener" href="https://github.com/Hashnode/mern-starter/issues/149">https://github.com/Hashnode/mern-starter/issues/149</a></p>
</li>
<li><p>and so on…</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://sososoyoung.github.io/2017/08/25/react-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E5%90%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%87%8D%E6%96%B0%E6%B8%B2%E6%9F%93%E5%8E%9F%E5%9B%A0%E5%88%86%E6%9E%90/" data-id="ckzdooxi1000kfpbdbh0b2kzl" data-title="react 服务端渲染后客户端重新渲染原因分析" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react-server-render/" rel="tag">react-server-render</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/03/31/sharehelper/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Neuer</strong>
      <div class="article-nav-title">
        
          网页常用分享相关meta设置
        
      </div>
    </a>
  
  
    <a href="/2017/05/02/%E8%A7%A3%E5%86%B3%E6%9F%90%E4%BA%9B%E7%BD%91%E9%A1%B5%E6%97%A0%E6%B3%95%E5%A4%8D%E5%88%B6%E7%9A%84%E9%97%AE%E9%A2%98/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Älter</strong>
      <div class="article-nav-title">解决某些网页无法复制的问题</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Oh-my-zsh/">Oh my zsh</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/react/">react</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/setting/">setting</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/share-web/">share, web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/sublime/">sublime</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9A%8F%E7%AC%94/">随笔</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Oh-my-zsh/" rel="tag">Oh my zsh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git-git-flow/" rel="tag">git, git flow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git-note/" rel="tag">git, note</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/homeassistant-python-N1-armbian-%E6%A0%91%E8%8E%93%E6%B4%BE/" rel="tag">homeassistant, python, N1, armbian, 树莓派</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac-brew-node-ide/" rel="tag">mac brew node ide</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python-cmd-virtualenv-pip-requirements/" rel="tag">python, cmd, virtualenv, pip, requirements</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react-server-render/" rel="tag">react-server-render</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/share-twitter-share-facebook-share/" rel="tag">share, twitter share, facebook share</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sublime/" rel="tag">sublime</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Oh-my-zsh/" style="font-size: 10px;">Oh my zsh</a> <a href="/tags/git-git-flow/" style="font-size: 10px;">git, git flow</a> <a href="/tags/git-note/" style="font-size: 10px;">git, note</a> <a href="/tags/homeassistant-python-N1-armbian-%E6%A0%91%E8%8E%93%E6%B4%BE/" style="font-size: 10px;">homeassistant, python, N1, armbian, 树莓派</a> <a href="/tags/mac-brew-node-ide/" style="font-size: 10px;">mac brew node ide</a> <a href="/tags/python-cmd-virtualenv-pip-requirements/" style="font-size: 10px;">python, cmd, virtualenv, pip, requirements</a> <a href="/tags/react-server-render/" style="font-size: 10px;">react-server-render</a> <a href="/tags/share-twitter-share-facebook-share/" style="font-size: 10px;">share, twitter share, facebook share</a> <a href="/tags/sublime/" style="font-size: 10px;">sublime</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 10px;">随笔</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/07/01/homeassistant-install-guide/">homeassistant 安装指南</a>
          </li>
        
          <li>
            <a href="/2019/07/01/python-commands/">python常用命令行</a>
          </li>
        
          <li>
            <a href="/2018/03/31/sharehelper/">网页常用分享相关meta设置</a>
          </li>
        
          <li>
            <a href="/2017/08/25/react-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E5%90%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%87%8D%E6%96%B0%E6%B8%B2%E6%9F%93%E5%8E%9F%E5%9B%A0%E5%88%86%E6%9E%90/">react 服务端渲染后客户端重新渲染原因分析</a>
          </li>
        
          <li>
            <a href="/2017/05/02/%E8%A7%A3%E5%86%B3%E6%9F%90%E4%BA%9B%E7%BD%91%E9%A1%B5%E6%97%A0%E6%B3%95%E5%A4%8D%E5%88%B6%E7%9A%84%E9%97%AE%E9%A2%98/">解决某些网页无法复制的问题</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 豆腐di青春<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>